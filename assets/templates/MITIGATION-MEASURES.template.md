<!-- Code-First Deep Threat Modeling Workflow | Version 2.1.0 | https://github.com/fr33d3m0n/skill-threat-modeling | License: BSD-3-Clause | Welcome to cite but please retain all sources and declarations -->

# 缓解措施报告: {PROJECT_NAME}

> **评估时间**: {ASSESSMENT_DATETIME}
> **分析师**: Claude (STRIDE Deep Threat Modeling)
> **框架版本**: STRIDE-TM v1.0.2
> **报告版本**: {REPORT_VERSION}
> **总措施数**: {TOTAL_MITIGATION_COUNT}

---

## 1. 缓解优先级矩阵

### 1.1 按优先级分组统计

| 优先级 | 描述 | 措施数 | 覆盖风险数 | 预计风险降低 |
|--------|------|--------|-----------|-------------|
| **P0** | 立即修复 | {P0_COUNT} | {P0_RISKS} | {P0_REDUCTION}% |
| **P1** | 紧急 | {P1_COUNT} | {P1_RISKS} | {P1_REDUCTION}% |
| **P2** | 高优先级 | {P2_COUNT} | {P2_RISKS} | {P2_REDUCTION}% |
| **P3** | 计划中 | {P3_COUNT} | {P3_RISKS} | {P3_REDUCTION}% |
| **总计** | | **{TOTAL_COUNT}** | **{TOTAL_RISKS}** | **{TOTAL_REDUCTION}%** |

### 1.2 缓解效果预估

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Mitigation Effectiveness                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  当前风险状态:                                                               │
│  ████████████████████████████████████████████████ 100% ({TOTAL_RISKS} 风险)  │
│                                                                              │
│  实施 P0 措施后:                                                             │
│  ██████████████████████████████████░░░░░░░░░░░░░░ {AFTER_P0}%               │
│                                                                              │
│  实施 P0+P1 措施后:                                                          │
│  ██████████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░ {AFTER_P1}%               │
│                                                                              │
│  实施 P0+P1+P2 措施后:                                                       │
│  ██████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ {AFTER_P2}%               │
│                                                                              │
│  全部措施实施后:                                                             │
│  ████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ {AFTER_ALL}% (残余风险)    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. P0 - 立即修复措施

> **说明**: 这些措施针对 Critical 级别风险，需要立即实施。

{P0_MITIGATIONS_SECTION}

<!--
=============================================================================
缓解措施模板 v2.0 (含修复定位)
=============================================================================

### M-{SEQ}: {MITIGATION_TITLE}

**针对威胁**:
| 威胁ID | 风险名称 | 严重程度 |
|--------|---------|---------|
| {THREAT_ID_1} | {THREAT_NAME_1} | {SEVERITY_1} |
| {THREAT_ID_2} | {THREAT_NAME_2} | {SEVERITY_2} |

**风险降低**: {RISK_REDUCTION}%

#### 🎯 修复定位

##### 主要修复位置
| 定位层级 | 值 | 说明 |
|---------|-----|------|
| **模块** | {MODULE_NAME} | 所属功能模块 |
| **功能/类** | {FUNCTION_OR_CLASS} | 具体功能或类名 |
| **文件** | `{FILE_PATH}` | 源代码文件路径 |
| **行号** | L{LINE_START}-L{LINE_END} | 需要修改的行范围 |

##### 修复点详情
```
文件: {FILE_PATH}
行号: {LINE_NUMBER}
上下文:
{LINE_NUMBER-2} | {CONTEXT_LINE_1}
{LINE_NUMBER-1} | {CONTEXT_LINE_2}
{LINE_NUMBER}   | >>> {VULNERABLE_LINE} <<< ← 修复此处
{LINE_NUMBER+1} | {CONTEXT_LINE_4}
{LINE_NUMBER+2} | {CONTEXT_LINE_5}
```

##### 关联修复位置
| 文件 | 行号 | 修改类型 | 说明 |
|------|------|---------|------|
| `{RELATED_FILE_1}` | L{LINE_1} | {CHANGE_TYPE_1} | {CHANGE_DESC_1} |
| `{RELATED_FILE_2}` | L{LINE_2} | {CHANGE_TYPE_2} | {CHANGE_DESC_2} |

<!-- 修改类型: 新增(add), 修改(modify), 删除(delete), 配置(config) -->

---

**当前状态**:

{CURRENT_STATE_DESCRIPTION}

```{CODE_LANGUAGE}
// 存在问题的代码
{VULNERABLE_CODE}
```

**推荐控制**:

{RECOMMENDED_CONTROL_DESCRIPTION}

**实现代码示例**:

```{CODE_LANGUAGE}
// 修复后的代码
{SECURE_CODE}
```

**实施步骤**:

1. {STEP_1}
2. {STEP_2}
3. {STEP_3}
4. {STEP_4}

**依赖项**:

| 依赖 | 类型 | 说明 |
|------|------|------|
| {DEPENDENCY_1} | {DEP_TYPE_1} | {DEP_DESC_1} |
| {DEPENDENCY_2} | {DEP_TYPE_2} | {DEP_DESC_2} |

**验证方法**:

```{TEST_LANGUAGE}
// 验证测试代码
{VERIFICATION_CODE}
```

**回滚计划**:

{ROLLBACK_PLAN}

---

-->

---

## 3. P1 - 紧急措施

> **说明**: 这些措施针对 High 级别风险。

{P1_MITIGATIONS_SECTION}

---

## 4. P2 - 高优先级措施

> **说明**: 这些措施针对 Medium 级别风险。

{P2_MITIGATIONS_SECTION}

---

## 5. P3 - 计划中措施

> **说明**: 这些措施针对 Low 级别风险或长期架构改进。

{P3_MITIGATIONS_SECTION}

---

## 6. 实施路线图

### 6.1 按优先级排序

| 阶段 | 优先级 | 措施 | 依赖 | 风险降低 | 资源需求 |
|------|--------|------|------|---------|---------|
{IMPLEMENTATION_ROADMAP_TABLE}
<!--
格式:
| 阶段 1 | P0 | M-001, M-002, M-003 | 无 | 35% | 3 人天 |
| 阶段 2 | P1 | M-004, M-005 | 阶段 1 完成 | 25% | 5 人天 |
| 阶段 3 | P2 | M-006, M-007, M-008 | 阶段 2 完成 | 20% | 8 人天 |
| 阶段 4 | P3 | M-009, M-010 | 阶段 3 完成 | 10% | 10 人天 |
-->

### 6.2 依赖关系图

```
{DEPENDENCY_GRAPH}
```
<!--
示例:
┌─────────────────────────────────────────────────────────────────┐
│                    Mitigation Dependencies                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  M-001 (JWT密钥) ──────┬──► M-003 (会话管理)                     │
│                        │                                         │
│  M-002 (输入验证) ─────┴──► M-004 (SQL注入修复)                  │
│                                   │                              │
│                                   └──► M-006 (数据加密)          │
│                                                                  │
│  M-005 (日志审计) ────────────────────► M-008 (监控告警)         │
│                                                                  │
│  独立措施: M-007 (HTTPS强制), M-009 (密码策略)                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
-->

### 6.3 防御纵深架构

```
{DEFENSE_IN_DEPTH_ASCII}
```
<!--
示例:
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Defense in Depth Architecture                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Layer 1: Network Security                                                   │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │  • WAF (M-010)                                                         │  │
│  │  • DDoS Protection (M-011)                                             │  │
│  │  • TLS 1.3 (M-007)                                                     │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                                    ▼                                         │
│  Layer 2: Application Security                                               │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │  • Input Validation (M-002)                                            │  │
│  │  • Output Encoding (M-012)                                             │  │
│  │  • CSRF Protection (M-013)                                             │  │
│  │  • Rate Limiting (M-014)                                               │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                                    ▼                                         │
│  Layer 3: Authentication & Authorization                                     │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │  • Strong JWT (M-001)                                                  │  │
│  │  • Session Management (M-003)                                          │  │
│  │  • MFA (M-015)                                                         │  │
│  │  • RBAC Enhancement (M-016)                                            │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                                    ▼                                         │
│  Layer 4: Data Security                                                      │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │  • Encryption at Rest (M-006)                                          │  │
│  │  • Encryption in Transit (M-017)                                       │  │
│  │  • Key Management (M-018)                                              │  │
│  │  • Data Masking (M-019)                                                │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                                    ▼                                         │
│  Layer 5: Monitoring & Response                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │  • Security Logging (M-005)                                            │  │
│  │  • Alerting (M-008)                                                    │  │
│  │  • Incident Response (M-020)                                           │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
-->

---

## 7. 合规映射

### 7.1 措施-合规框架对应

| 措施 | NIST CSF | ISO 27001 | OWASP | PCI-DSS |
|------|----------|-----------|-------|---------|
{COMPLIANCE_MAPPING_TABLE}
<!--
格式:
| M-001 (JWT密钥) | PR.AC-1 | A.9.4.2 | A2:2021 | 6.5.10 |
| M-002 (输入验证) | PR.DS-5 | A.14.2.5 | A3:2021 | 6.5.1 |
| M-003 (会话管理) | PR.AC-4 | A.9.4.3 | A7:2021 | 6.5.10 |
-->

### 7.2 控制覆盖度

| 合规框架 | 相关控制 | 已覆盖 | 覆盖率 |
|---------|---------|--------|-------|
| OWASP Top 10 | {OWASP_CONTROLS} | {OWASP_COVERED} | {OWASP_COVERAGE}% |
| NIST CSF | {NIST_CONTROLS} | {NIST_COVERED} | {NIST_COVERAGE}% |
| ISO 27001 | {ISO_CONTROLS} | {ISO_COVERED} | {ISO_COVERAGE}% |
| PCI-DSS | {PCI_CONTROLS} | {PCI_COVERED} | {PCI_COVERAGE}% |

---

## 8. 安全控制参考

### 8.1 知识库来源

| 控制类别 | KB文件 | 使用措施 |
|---------|--------|---------|
{KB_REFERENCE_TABLE}
<!--
格式:
| 认证控制 | codeguard-authentication.yaml | M-001, M-003, M-015 |
| 输入验证 | codeguard-input-validation.yaml | M-002, M-004 |
| 加密控制 | codeguard-cryptography.yaml | M-006, M-017, M-018 |
-->

### 8.2 推荐安全库

| 用途 | 推荐库 | 版本 | 说明 |
|------|-------|------|------|
{RECOMMENDED_LIBRARIES_TABLE}
<!--
格式:
| JWT处理 | jose | >=4.0.0 | 现代JWT库，支持JWE |
| 密码哈希 | argon2 | >=2.0.0 | 推荐的密码哈希算法 |
| 输入验证 | zod | >=3.0.0 | TypeScript优先的验证库 |
| 加密 | crypto (内置) | N/A | Node.js内置加密模块 |
-->

---

## 9. 监控与验证

### 9.1 实施验证清单

| 措施 | 验证方法 | 验证命令/测试 | 预期结果 |
|------|---------|-------------|---------|
{VERIFICATION_CHECKLIST}
<!--
格式:
| M-001 | 自动化测试 | `npm run test:security:jwt` | 所有JWT测试通过 |
| M-002 | 渗透测试 | SQL注入payload测试 | 所有请求被拦截 |
| M-006 | 配置检查 | `SELECT * FROM pg_settings WHERE name LIKE '%encrypt%'` | 加密已启用 |
-->

### 9.2 持续监控指标

| 指标 | 正常阈值 | 告警阈值 | 监控方式 |
|------|---------|---------|---------|
{MONITORING_METRICS}
<!--
格式:
| 认证失败率 | <1% | >5% | Prometheus metric |
| 异常请求率 | <0.1% | >1% | WAF dashboard |
| 加密覆盖率 | 100% | <100% | 配置审计 |
-->

---

**报告结束**

---

> **重要提示**:
> 1. 所有代码示例均为生产级代码，可直接使用
> 2. 实施前请在测试环境验证
> 3. 建议按优先级顺序实施，关注依赖关系
> 4. 本报告不包含时间估计，请根据实际资源情况规划
